<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PS1 Web Emulator - Sucesso Final</title>
    <!-- Tailwind CSS e Fontes -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- EmulatorJS -->
    <script src="https://cdn.emulatorjs.org/emulator.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        #game-container, #game-container > canvas {
            width: 100% !important;
            height: 100% !important;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl mx-auto">
        <header class="text-center mb-6">
            <h1 class="text-4xl font-bold text-blue-400">EMULADOR PS1 - SUCESSO FINAL!</h1>
            <p class="text-gray-400 mt-2">Versão final e funcional. Carregue um ficheiro .cue, .bin ou .iso.</p>
        </header>

        <main class="bg-gray-800 rounded-lg shadow-2xl p-4">
            <div id="emulator-screen" class="aspect-video bg-black rounded-md overflow-hidden relative">
                <div id="game-container" class="w-full h-full"></div>
                <div id="initial-message" class="absolute inset-0 flex flex-col items-center justify-center text-center p-4">
                     <svg class="w-16 h-16 text-gray-500 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 7.5V6.108c0-1.135.845-2.098 1.976-2.192.353-.026.692-.026 1.038 0 .346.026.685.026 1.038 0 1.13.094 1.976 1.057 1.976 2.192V7.5M8.25 7.5h7.5m-7.5 0-1.103 9.372c-.066.564.022 1.141.222 1.683.3.812.983 1.45 1.883 1.637C10.23 20.43 10.57 20.5 11 20.5h2c.43 0 .77-.07 1.11-.208.9-.187 1.583-.825 1.883-1.637.2-.542.288-1.12.222-1.683L15.75 7.5m-7.5 0-1.409-1.409a1.125 1.125 0 0 1 0-1.591l.296-.296a1.125 1.125 0 0 1 1.591 0L8.25 7.5m7.5 0 1.409-1.409a1.125 1.125 0 0 0 0-1.591l-.296-.296a1.125 1.125 0 0 0-1.591 0L15.75 7.5" />
                    </svg>
                    <h2 class="text-2xl font-semibold">Pronto para Jogar!</h2>
                    <p class="text-gray-400 mt-2">Dica: Para jogos com música, carregue o ficheiro <strong class="text-yellow-400">.CUE</strong>.</p>
                </div>
            </div>

            <div class="mt-4 grid grid-cols-2 sm:grid-cols-4 gap-4">
                 <button id="load-rom-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 flex items-center justify-center">
                    <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9.25 13.25a.75.75 0 0 0 1.5 0V4.636l2.955 3.129a.75.75 0 0 0 1.09-1.03l-4.25-4.5a.75.75 0 0 0-1.09 0l-4.25 4.5a.75.75 0 1 0 1.09 1.03L9.25 4.636v8.614Z" /><path d="M3.5 12.75a.75.75 0 0 0-1.5 0v2.5A2.75 2.75 0 0 0 4.75 18h10.5A2.75 2.75 0 0 0 18 15.25v-2.5a.75.75 0 0 0-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5Z" /></svg>
                    Carregar Jogo
                </button>
                <button id="save-state-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 flex items-center justify-center">
                    <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M3 3.5A1.5 1.5 0 0 1 4.5 2h6.879a1.5 1.5 0 0 1 1.06.44l4.122 4.12A1.5 1.5 0 0 1 17 7.622V16.5A1.5 1.5 0 0 1 15.5 18H4.5A1.5 1.5 0 0 1 3 16.5v-13Z" /><path d="M5 6.5A1.5 1.5 0 0 1 6.5 5h3A1.5 1.5 0 0 1 11 6.5v3A1.5 1.5 0 0 1 9.5 11h-3A1.5 1.5 0 0 1 5 9.5v-3Z" /></svg>
                    Salvar Estado
                </button>
                <button id="load-state-btn" class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 flex items-center justify-center">
                    <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a.75.75 0 0 1 .75.75v3.443l2.53-2.53a.75.75 0 0 1 1.06 1.06l-3.59 3.59a.75.75 0 0 1-1.06 0L6.16 4.72a.75.75 0 0 1 1.06-1.06l2.53 2.53V2.75A.75.75 0 0 1 10 2Z" /><path d="M3.5 9.75a.75.75 0 0 1 .75-.75h11.5a.75.75 0 0 1 0 1.5H4.25a.75.75 0 0 1-.75-.75Zm0 4a.75.75 0 0 1 .75-.75h11.5a.75.75 0 0 1 0 1.5H4.25a.75.75 0 0 1-.75-.75Z" /></svg>
                    Carregar Estado
                </button>
                <button id="fullscreen-btn" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 flex items-center justify-center">
                    <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M3 8.75A1.75 1.75 0 0 1 4.75 7h2.5a.75.75 0 0 1 0 1.5h-2.5A.25.25 0 0 0 4.5 9v2.5a.75.75 0 0 1-1.5 0V8.75ZM11.25 7a.75.75 0 0 1 .75.75v2.5a.75.75 0 0 1-1.5 0V9A.25.25 0 0 0 10.25 8.5h-2.5a.75.75 0 0 1 0-1.5h2.5A1.75 1.75 0 0 1 11.25 7ZM8.75 13a.75.75 0 0 1 .75.75v2.5A.25.25 0 0 0 9.75 16h2.5a.75.75 0 0 1 0 1.5h-2.5A1.75 1.75 0 0 1 8 15.25V13a.75.75 0 0 1 .75-.75ZM13 11.25a.75.75 0 0 1 .75.75v2.5A1.75 1.75 0 0 1 12.25 16h-2.5a.75.75 0 0 1 0-1.5h2.5a.25.25 0 0 0 .25-.25V12a.75.75 0 0 1 .75-.75Z" /></svg>
                    Ecrã Inteiro
                </button>
            </div>
            <!-- Adicionamos o suporte para .iso -->
            <input type="file" id="rom-input" hidden accept=".cue,.iso,.bin,.chd,.img">
        </main>
    </div>

    <script>
        // CORREÇÃO FINAL: Usamos window.onload para garantir que TUDO, incluindo o script externo do emulador,
        // está completamente carregado antes de executarmos o nosso código.
        window.onload = function() {
            const loadRomBtn = document.getElementById('load-rom-btn');
            const saveStateBtn = document.getElementById('save-state-btn');
            const loadStateBtn = document.getElementById('load-state-btn');
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            const romInput = document.getElementById('rom-input');
            const initialMessage = document.getElementById('initial-message');
            
            let isGameLoaded = false;
            
            // --- Lógica dos Botões ---
            loadRomBtn.addEventListener('click', () => {
                romInput.click();
            });

            romInput.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (!file) return;

                initialMessage.style.display = 'none';

                const gameUrl = URL.createObjectURL(file);
                
                // As configurações são definidas antes de criar a nova instância
                window.EJS_player = '#game-container';
                window.EJS_core = 'psx';
                window.EJS_gameUrl = gameUrl;
                window.EJS_lightgun = false;
                window.EJS_startOnLoaded = true; // Começa o jogo assim que carregar

                // Criamos uma nova instância do emulador. A função EJS_emulator agora existe.
                const emulator = new EJS_emulator({
                    system: 'psx',
                    div: '#game-container'
                });
                
                isGameLoaded = true;
            });

            saveStateBtn.addEventListener('click', () => {
                if (isGameLoaded && typeof EJS_savestate === 'function') {
                    EJS_savestate();
                }
            });

            loadStateBtn.addEventListener('click', () => {
                 if (isGameLoaded && typeof EJS_loadstate === 'function') {
                    EJS_loadstate();
                 }
            });

            fullscreenBtn.addEventListener('click', () => {
                if (isGameLoaded && typeof EJS_enterFullscreen === 'function') {
                    EJS_enterFullscreen();
                }
            });
        };
    </script>
</body>
</html>

